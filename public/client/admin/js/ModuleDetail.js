import{A as U,i as A,j as E,k as I,o as f,B as L,C as j,D as K,V as k,E as T,F as q,_ as H}from"./index.js";import{l as $}from"./lodash.js";import{_ as J}from"./SmartForm.vue_vue_type_script_setup_true_lang.js";import{V as w}from"./VSpacer.js";import{l as P,r as p,j as C,H as W,q as X,W as y,R as h,S as d,I as c,a9 as Y,X as b,F as z,Y as G,J as O,_ as x,$ as Q,u as D,aa as Z}from"./vue-codemirror.js";const _={class:"actions-wrapper"},ee=P({__name:"ModuleDetail",props:{id:{default:null},modal:{type:Boolean,default:!1},initialValues:{default:()=>({})},moduleKey:{}},emits:["onCreate","onUpdate","onClose","onDelete"],setup(l,{emit:F}){const B=U(),V=A(),M=E(),{mainRect:S}=I(),m=F,N=[{title:"Сбросить",condition:!0,action:()=>{},props:{color:"warning"}},{title:"Обновить",condition:()=>!!u.value,action:async()=>{var a,o,i;const e=await((a=s.value)==null?void 0:a.validate());if(e!=null&&e.valid){t.value=!0;try{const{data:v}=await f.patch(`/api/admin/${n.value.key}/${u.value}`,q(r.value,(o=s.value)==null?void 0:o.values));m("onUpdate",v),r.value=v,(i=s.value)==null||i.resetForm({values:r.value})}catch(v){console.log(v)}finally{t.value=!1}}},props:{color:"primary"}},{title:"Удалить",condition:()=>!!u.value,action:async()=>{try{t.value=!0,await f.delete(`/api/admin/${n.value.key}/${u.value}`),V.push({name:`${$.capitalize(n.value.key)}List`}),l.modal&&m("onDelete")}catch(e){console.log(e)}finally{t.value=!1}},props:{color:"red"}},{title:"Создать",condition:()=>!u.value,action:async()=>{var a,o;const e=await((a=s.value)==null?void 0:a.validate());if(e!=null&&e.valid){t.value=!0;try{const{data:i}=await f.post(`/api/admin/${n.value.key}`,(o=s.value)==null?void 0:o.values);l.modal?m("onCreate",{...i,order:0}):V.push({name:`${$.capitalize(n.value.key)}Detail`,params:{id:i.id}})}catch(i){console.log(i)}finally{t.value=!1}}},props:{color:"primary"}},{title:"Закрыть",condition:()=>l.modal,action:()=>{m("onClose")},props:{color:"primary"}}],t=p(!1),r=p(l.initialValues),s=p(),g=p([]),R=C(()=>N.filter(e=>typeof e.condition=="function"?e.condition():e.condition)),u=C(()=>l.modal?l.id:B.params.id),n=C(()=>M.modules[l.moduleKey]);return W(async()=>{var e;if(u.value){t.value=!0;try{const{data:a}=await f.get(`/api/admin/${n.value.key}/${u.value}`);g.value=n.value.getFields({entity:a,initialValues:l.initialValues}),r.value={...a,...l.initialValues},(e=s.value)==null||e.resetForm({values:r.value})}catch(a){console.log(a)}finally{t.value=!1}}else g.value=n.value.getFields({initialValues:l.initialValues}),r.value={...l.initialValues}}),X("form",s),(e,a)=>(y(),h(T,{outlined:"",rounded:"0",flat:"","max-height":`calc(100svh - ${D(S).top}px)`,class:"h-100 d-flex flex-column overflow-auto w-100",loading:t.value},{default:d(()=>[c(L,null,{default:d(()=>[c(J,{fields:g.value,initialValues:e.initialValues,loading:t.value},null,8,["fields","initialValues","loading"])]),_:1}),c(w),Y("div",_,[c(j),c(K,null,{default:d(()=>[(y(!0),b(z,null,G(R.value,(o,i)=>(y(),h(k,O({key:i},o.props,{onClick:o.action}),{default:d(()=>[x(Q(o.title),1)]),_:2},1040,["onClick"]))),128)),c(w),e.modal?Z("",!0):(y(),h(k,{key:0,onClick:a[0]||(a[0]=o=>D(V).go(-1))},{default:d(()=>[x("Назад")]),_:1}))]),_:1})])]),_:1},8,["max-height","loading"]))}}),de=H(ee,[["__scopeId","data-v-94750549"]]);export{de as M};
