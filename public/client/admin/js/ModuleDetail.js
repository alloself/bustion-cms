import{l as E,i as I,j as K,k as L,s as f,D as R,E as j,F as A,n as k,G as H,H as T,_ as b}from"./index.js";import{l as $}from"./lodash.js";import{_ as q}from"./SmartForm.vue_vue_type_script_setup_true_lang.js";import{V as w}from"./VSpacer.js";import{l as G,r as p,j as C,I as P,q as W,W as y,U as h,X as d,H as c,ab as X,Y,F as Z,Z as z,K as J,$ as x,a0 as O,u as D,ac as Q}from"./vue-codemirror.js";const _={class:"actions-wrapper"},ee=G({__name:"ModuleDetail",props:{id:{default:null},modal:{type:Boolean,default:!1},initialValues:{default:()=>({})},moduleKey:{}},emits:["onCreate","onUpdate","onClose","onDelete"],setup(l,{emit:F}){const B=E(),V=I(),M=K(),{mainRect:U}=L(),m=F,N=[{title:"Сбросить",condition:!0,action:()=>{},props:{color:"warning"}},{title:"Обновить",condition:()=>!!u.value,action:async()=>{var a,o,i;const e=await((a=s.value)==null?void 0:a.validate());if(e!=null&&e.valid){t.value=!0;try{const{data:v}=await f.patch(`/api/admin/${n.value.key}/${u.value}`,T(r.value,(o=s.value)==null?void 0:o.values));m("onUpdate",v),r.value=v,(i=s.value)==null||i.resetForm({values:r.value})}catch(v){console.log(v)}finally{t.value=!1}}},props:{color:"primary"}},{title:"Удалить",condition:()=>!!u.value,action:async()=>{try{t.value=!0,await f.delete(`/api/admin/${n.value.key}/${u.value}`),V.push({name:`${$.capitalize(n.value.key)}List`}),l.modal&&m("onDelete")}catch(e){console.log(e)}finally{t.value=!1}},props:{color:"red"}},{title:"Создать",condition:()=>!u.value,action:async()=>{var a,o;const e=await((a=s.value)==null?void 0:a.validate());if(e!=null&&e.valid){t.value=!0;try{const{data:i}=await f.post(`/api/admin/${n.value.key}`,(o=s.value)==null?void 0:o.values);l.modal?m("onCreate",{...i,order:0}):V.push({name:`${$.capitalize(n.value.key)}Detail`,params:{id:i.id}})}catch(i){console.log(i)}finally{t.value=!1}}},props:{color:"primary"}},{title:"Закрыть",condition:()=>l.modal,action:()=>{m("onClose")},props:{color:"primary"}}],t=p(!1),r=p(l.initialValues),s=p(),g=p([]),S=C(()=>N.filter(e=>typeof e.condition=="function"?e.condition():e.condition)),u=C(()=>l.modal?l.id:B.params.id),n=C(()=>M.modules[l.moduleKey]);return P(async()=>{var e;if(u.value){t.value=!0;try{const{data:a}=await f.get(`/api/admin/${n.value.key}/${u.value}`);g.value=n.value.getFields({entity:a,initialValues:l.initialValues}),r.value={...a,...l.initialValues},(e=s.value)==null||e.resetForm({values:r.value})}catch(a){console.log(a)}finally{t.value=!1}}else g.value=n.value.getFields({initialValues:l.initialValues}),r.value={...l.initialValues}}),W("form",s),(e,a)=>(y(),h(H,{outlined:"",rounded:"0",flat:"","max-height":`calc(100svh - ${D(U).top}px)`,class:"h-100 d-flex flex-column overflow-auto w-100",loading:t.value},{default:d(()=>[c(R,null,{default:d(()=>[c(q,{fields:g.value,initialValues:e.initialValues,loading:t.value},null,8,["fields","initialValues","loading"])]),_:1}),c(w),X("div",_,[c(j),c(A,null,{default:d(()=>[(y(!0),Y(Z,null,z(S.value,(o,i)=>(y(),h(k,J({key:i,ref_for:!0},o.props,{onClick:o.action}),{default:d(()=>[x(O(o.title),1)]),_:2},1040,["onClick"]))),128)),c(w),e.modal?Q("",!0):(y(),h(k,{key:0,onClick:a[0]||(a[0]=o=>D(V).go(-1))},{default:d(()=>[x("Назад")]),_:1}))]),_:1})])]),_:1},8,["max-height","loading"]))}}),de=b(ee,[["__scopeId","data-v-77344134"]]);export{de as M};
