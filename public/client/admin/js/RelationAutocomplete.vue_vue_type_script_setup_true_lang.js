import{j as g,a0 as h,o as C}from"./index.js";import{l as K}from"./lodash.js";import{M as u}from"./ModuleDetail.js";import{V as k}from"./VAutocomplete.js";import{l as w,j as B,r as t,w as i,V as S,Q as U,J as b}from"./vue-codemirror.js";const D=w({__name:"RelationAutocomplete",props:{readonly:{type:Boolean},moduleKey:{},modelValue:{},loading:{type:Boolean}},emits:["update:model-value"],setup(l,{emit:p}){const c=g(),a=h(),s=p,y=B(()=>c.modules[l.moduleKey]),r=t([]),n=t(""),d=t(!1),m=async(e={})=>{d.value=!0;try{const{data:o}=await C.get(`/api/admin/${y.value.key}`,{params:{...e}});r.value=o}catch(o){console.log(o)}finally{d.value=!1}},f=()=>{a.addModal({component:u,props:{modal:!0,moduleKey:l.moduleKey},actions:{onClose:a.onModalClose,onCreate:e=>{s("update:model-value",e.id),a.onModalClose()}}}),a.show=!0},v=e=>{s("update:model-value",e)},V=()=>{a.addModal({component:u,props:{modal:!0,moduleKey:l.moduleKey,id:l.modelValue},actions:{onClose:a.onModalClose}}),a.show=!0};return i(()=>n.value,K.debounce((e,o)=>{!e||e===o||e&&m({search:e})},300)),i(()=>l.modelValue,e=>{e||(n.value=""),e&&m()},{immediate:!0}),(e,o)=>(S(),U(k,b({clearable:!e.readonly,readonly:e.readonly,loading:e.loading||d.value,"model-value":d.value?null:e.modelValue,"onUpdate:modelValue":v,search:n.value,"onUpdate:search":o[0]||(o[0]=M=>n.value=M),"prepend-icon":e.readonly?"":"mdi-plus","prepend-inner-icon":e.modelValue&&!e.readonly?"mdi-pencil":""},e.$attrs,{"onClick:prepend":f,"onClick:prependInner":V,"no-data-text":"Нет данных",items:r.value}),null,16,["clearable","readonly","loading","model-value","onUpdate:modelValue","search","prepend-icon","prepend-inner-icon","items"]))}});export{D as _};
